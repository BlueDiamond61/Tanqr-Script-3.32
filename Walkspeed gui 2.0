local KEY="WC$552"
local DEFAULT_SPEED=16
local MAX_SAFE_SPEED=120

local Players=game:GetService("Players")
local RunService=game:GetService("RunService")
local UIS=game:GetService("UserInputService")
local LocalPlayer=Players.LocalPlayer

local humanoid
local keyAccepted=false
local antiFling=true
local softLimit=true
local espEnabled=false
local flyEnabled=false
local smoothingFactor=10
local currentTargetSpeed=DEFAULT_SPEED
local flying=false
local flySpeed=50
local ESPBoxes={}

local function getHumanoid()
    local c=LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
    return c:WaitForChild("Humanoid")
end

humanoid=getHumanoid()
LocalPlayer.CharacterAdded:Connect(function()
    humanoid=getHumanoid()
    humanoid.WalkSpeed=currentTargetSpeed
end)

local function corner(p,r)
    local c=Instance.new("UICorner")
    c.CornerRadius=UDim.new(0,r or 6)
    c.Parent=p
end

local function button(parent,y,text,color)
    local b=Instance.new("TextButton")
    b.Size=UDim2.new(1,-40,0,28)
    b.Position=UDim2.new(0,20,0,y)
    b.BackgroundColor3=color or Color3.fromRGB(50,50,50)
    b.Text=text
    b.TextScaled=true
    b.Font=Enum.Font.GothamSemibold
    b.TextColor3=Color3.fromRGB(245,245,245)
    corner(b,8)
    b.MouseEnter:Connect(function()b.BackgroundColor3=Color3.fromRGB(80,80,80)end)
    b.MouseLeave:Connect(function()b.BackgroundColor3=color or Color3.fromRGB(50,50,50)end)
    b.Parent=parent
    return b
end

local gui=Instance.new("ScreenGui",LocalPlayer.PlayerGui)
gui.ResetOnSpawn=false

local loadingFrame=Instance.new("Frame",gui)
loadingFrame.Size=UDim2.new(1,0,1,0)
loadingFrame.BackgroundColor3=Color3.new(0,0,0)

local playButton=button(loadingFrame,0,"PLAY",Color3.fromRGB(50,150,255))
playButton.Position=UDim2.new(0.5,-70,0.5,-20)
playButton.Size=UDim2.new(0,140,0,40)

local keyFrame=Instance.new("Frame",gui)
keyFrame.Size=UDim2.new(0,280,0,150)
keyFrame.Position=UDim2.new(0.5,-140,0.45,-75)
keyFrame.BackgroundColor3=Color3.fromRGB(40,40,40)
keyFrame.Visible=false
corner(keyFrame,12)

local keyBox=Instance.new("TextBox",keyFrame)
keyBox.Size=UDim2.new(1,-40,0,32)
keyBox.Position=UDim2.new(0,20,0,50)
keyBox.BackgroundColor3=Color3.fromRGB(60,60,60)
keyBox.PlaceholderText="••••••"
keyBox.TextColor3=Color3.fromRGB(245,245,245)
keyBox.Font=Enum.Font.GothamSemibold
keyBox.TextScaled=true
corner(keyBox,8)

local submitBtn=button(keyFrame,92,"Unlock")
local keyFeedback=Instance.new("TextLabel",keyFrame)
keyFeedback.Size=UDim2.new(1,-30,0,18)
keyFeedback.Position=UDim2.new(0,15,0,130)
keyFeedback.BackgroundTransparency=1
keyFeedback.TextScaled=true
keyFeedback.TextColor3=Color3.fromRGB(255,100,100)
keyFeedback.Font=Enum.Font.GothamSemibold

playButton.MouseButton1Click:Connect(function()
    loadingFrame:Destroy()
    keyFrame.Visible=true
end)

local mainFrame=Instance.new("Frame",gui)
mainFrame.Size=UDim2.new(0,300,0,300)
mainFrame.Position=UDim2.new(0.5,-150,0.4,-150)
mainFrame.BackgroundColor3=Color3.fromRGB(60,60,60)
mainFrame.Visible=false
corner(mainFrame,12)

local speedBox=Instance.new("TextBox",mainFrame)
speedBox.Size=UDim2.new(1,-40,0,28)
speedBox.Position=UDim2.new(0,20,0,45)
speedBox.BackgroundColor3=Color3.fromRGB(80,80,80)
speedBox.PlaceholderText="Enter speed"
speedBox.TextColor3=Color3.new(1,1,1)
speedBox.Font=Enum.Font.GothamSemibold
speedBox.TextScaled=true
corner(speedBox,8)

local applySpeed=button(mainFrame,80,"Apply Speed")
local resetSpeed=button(mainFrame,120,"Reset Speed")
local settingsBtn=button(mainFrame,160,"Settings")

local settingsFrame=Instance.new("Frame",gui)
settingsFrame.Size=UDim2.new(0,260,0,220)
settingsFrame.Position=mainFrame.Position
settingsFrame.BackgroundColor3=Color3.fromRGB(70,70,70)
settingsFrame.Visible=false
corner(settingsFrame,12)

local antiBtn=button(settingsFrame,50,"Anti-Fling: ON")
local softBtn=button(settingsFrame,90,"Soft Limit: ON")
local espBtn=button(settingsFrame,130,"ESP: OFF")
local flyBtn=button(settingsFrame,170,"Fly: OFF")
local backBtn=button(settingsFrame,200,"Back")

submitBtn.MouseButton1Click:Connect(function()
    if keyBox.Text==KEY then
        keyFeedback.TextColor3=Color3.fromRGB(0,255,0)
        keyFeedback.Text="Key Accepted!"
        keyFrame.Visible=false
        mainFrame.Visible=true
        keyAccepted=true
    else
        keyFeedback.TextColor3=Color3.fromRGB(255,50,50)
        keyFeedback.Text="Wrong Key!"
    end
end)

applySpeed.MouseButton1Click:Connect(function()
    local v=tonumber(speedBox.Text)
    if v then
        currentTargetSpeed=softLimit and math.clamp(v,1,MAX_SAFE_SPEED) or v
    end
end)

resetSpeed.MouseButton1Click:Connect(function()
    currentTargetSpeed=DEFAULT_SPEED
end)

settingsBtn.MouseButton1Click:Connect(function()
    mainFrame.Visible=false
    settingsFrame.Visible=true
end)

backBtn.MouseButton1Click:Connect(function()
    settingsFrame.Visible=false
    mainFrame.Visible=true
end)

antiBtn.MouseButton1Click:Connect(function()
    antiFling=not antiFling
    antiBtn.Text="Anti-Fling: "..(antiFling and "ON" or "OFF")
end)

softBtn.MouseButton1Click:Connect(function()
    softLimit=not softLimit
    softBtn.Text="Soft Limit: "..(softLimit and "ON" or "OFF")
end)

espBtn.MouseButton1Click:Connect(function()
    espEnabled=not espEnabled
    espBtn.Text="ESP: "..(espEnabled and "ON" or "OFF")
end)

flyBtn.MouseButton1Click:Connect(function()
    flyEnabled=not flyEnabled
    flying=flyEnabled
    flyBtn.Text="Fly: "..(flyEnabled and "ON" or "OFF")
end)

local function updateESP()
    for _,plr in ipairs(Players:GetPlayers()) do
        if plr~=LocalPlayer then
            if espEnabled and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
                if not ESPBoxes[plr] then
                    local box=Instance.new("BillboardGui")
                    box.Size=UDim2.new(0,50,0,50)
                    box.AlwaysOnTop=true
                    box.Adornee=plr.Character.HumanoidRootPart
                    local f=Instance.new("Frame",box)
                    f.Size=UDim2.new(1,0,1,0)
                    f.BackgroundColor3=Color3.fromRGB(255,50,50)
                    f.BorderSizePixel=1
                    corner(f,4)
                    box.Parent=gui
                    ESPBoxes[plr]=box
                end
            else
                if ESPBoxes[plr] then
                    ESPBoxes[plr]:Destroy()
                    ESPBoxes[plr]=nil
                end
            end
        end
    end
end

Players.PlayerRemoving:Connect(function(p)
    if ESPBoxes[p] then
        ESPBoxes[p]:Destroy()
        ESPBoxes[p]=nil
    end
end)

RunService.Heartbeat:Connect(function(dt)
    if not keyAccepted or not humanoid then return end
    humanoid.WalkSpeed+= (currentTargetSpeed-humanoid.WalkSpeed)*math.clamp(dt*smoothingFactor,0,1)
    if antiFling then
        local r=LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
        if r and r.Velocity.Magnitude>150 then
            r.Velocity=r.Velocity.Unit*150
        end
    end
    if flying and LocalPlayer.Character then
        local r=LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
        if r then
            local v=Vector3.zero
            local cam=workspace.CurrentCamera.CFrame
            if UIS:IsKeyDown(Enum.KeyCode.W) then v+=cam.LookVector end
            if UIS:IsKeyDown(Enum.KeyCode.S) then v-=cam.LookVector end
            if UIS:IsKeyDown(Enum.KeyCode.A) then v-=cam.RightVector end
            if UIS:IsKeyDown(Enum.KeyCode.D) then v+=cam.RightVector end
            if v.Magnitude>0 then
                r.Velocity=Vector3.new(v.Unit.X*flySpeed,r.Velocity.Y,v.Unit.Z*flySpeed)
            end
        end
    end
    updateESP()
end)

UIS.InputBegan:Connect(function(i,gp)
    if gp then return end
    if i.KeyCode==Enum.KeyCode.RightShift then
        mainFrame.Visible=not mainFrame.Visible
        settingsFrame.Visible=false
    end
end)
